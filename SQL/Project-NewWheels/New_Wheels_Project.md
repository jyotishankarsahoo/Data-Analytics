## SQL Analysis of New-Wheels Sales and Customer 

This document presents the SQL queries and observations for analyzing customer and order data.

---

### Question 1.1: Find the total number of customers who have placed orders. 

**SQL Query:**

```sql
SELECT
    COUNT(DISTINCT(customer_id)) AS TOTAL_CUSTOMER
FROM customer_t
WHERE customer_id IN (
SELECT 
    customer_id 
FROM order_t);
```
**Observation:**

* There are **994** Customers who have placed orders.

---

### Question 1.2: What is the distribution of the customers across states?

**SQL Query:**

```sql
SELECT
    state,
    COUNT(customer_id) AS NUMBER_OF_CUSTOMER
FROM customer_t
GROUP BY state
ORDER BY NUMBER_OF_CUSTOMER DESC;
```
**Observation:**

* Most Number of customers are residing in Texas (97) and California (97) followed by Florida, New York

---
### Question 2: Which are the top 5 vehicle makers preferred by the customers?

**SQL Query:**

```sql
SELECT
    vehicle_maker,
    COUNT(*) AS NUMBER_OF_CUSTOMER
FROM product_t P
    JOIN order_t O
    USING (product_id)
GROUP BY vehicle_maker
ORDER BY NUMBER_OF_CUSTOMER DESC
LIMIT 5;
```
**Observation:**
* **`Chevrolet(83)`** is the most preferred vehicle By Customers followed by Ford(63), Toyota(52),Pontiac(50), Dodge(50).

---
### Question 3: Which is the most preferred vehicle maker in each state?

**SQL Query:**

```sql
SELECT * FROM (
    SELECT
        state,
        vehicle_maker,
        COUNT(customer_id) AS TOTAL_CUSTOMER,
        RANK() OVER(PARTITION BY state ORDER BY COUNT(customer_id) DESC) AS
RNK
    FROM product_t P
        JOIN order_t O
        USING (product_id)
        JOIN customer_t C
        USING (customer_id)
    GROUP BY state, vehicle_maker
) AS PREF_VEHICLE
WHERE RNK = 1
ORDER BY TOTAL_CUSTOMER DESC;
```
**Observation:**
* Most Preferred vehicle In `Texas` is `Chevrolet` with highest customers count being **9**.
* In Florida `Toyota` is most preferred vehicle with **7** customers.

---
### Question 4: Find the overall average rating given by the customers. What is the average rating in each quarter? Consider the following mapping for ratings: `Very Bad: 1`, `Bad: 2`, `Okay: 3`, `Good: 4`, `Very Good: 5`

**SQL Query:**

```sql
SELECT
    quarter_number, ROUND(AVG(RATING),2) AS AVG_RATING
FROM (
    SELECT
        quarter_number,
        CASE
            WHEN customer_feedback='Very Bad' THEN 1
            WHEN customer_feedback='Bad' THEN 2
            WHEN customer_feedback='Okay' THEN 3
            WHEN customer_feedback='Good' THEN 4
            WHEN customer_feedback='Very Good' THEN 5
        END AS RATING
    FROM order_t
) AS RATING_TABLE
GROUP BY quarter_number
ORDER BY quarter_number;
```
**Observation:**
* It is evident form the data that customer rating is **decreasing with each quarter.**
* While `Quarter 1` is having **Okay / Good Avg** Customer rating **3.55**, `Quarter 4` is having **Bad Avg Customer rating 2.4**.

---
### Question 5: Find the percentage distribution of feedback from the customers. Are customers getting more dissatisfied over time?

**SQL Query:**

```sql
SELECT
    quarter_number,
    ROUND((VERY_BAD/TOTAL_FEEDBACK), 2) AS VERY_BAD,
    ROUND(BAD/TOTAL_FEEDBACK, 2) AS BAD,
    ROUND(OKAY/TOTAL_FEEDBACK, 2) AS OKAY,
    ROUND(GOOD/TOTAL_FEEDBACK, 2) AS GOOD,
    ROUND(VERY_GOOD/TOTAL_FEEDBACK, 2) AS VERY_GOOD
FROM (
    SELECT
        quarter_number,
        ROUND(SUM(CASE WHEN customer_feedback='Very Bad' THEN 1 ELSE 0 END), 2) AS VERY_BAD,
        ROUND(SUM(CASE WHEN customer_feedback='Bad' THEN 1 ELSE 0 END), 2) AS BAD,
        ROUND(SUM(CASE WHEN customer_feedback='Okay' THEN 1 ELSE 0 END), 2) AS OKAY,
        ROUND(SUM(CASE WHEN customer_feedback='Good' THEN 1 ELSE 0 END), 2) AS GOOD,
        ROUND(SUM(CASE WHEN customer_feedback='Very Good' THEN 1 ELSE 0 END), 2) AS VERY_GOOD,
        ROUND(COUNT(customer_feedback), 2) AS TOTAL_FEEDBACK
FROM order_t
GROUP BY quarter_number) AS TEMP_TABLE
GROUP BY quarter_number;
```
**Observation:**
* The rating of **Very Bad and Bad has increased** from `0.11 to 0.31, 0.29` respectively, whereas Good and
Verify **Good rating decreased** from `0.29, 0.3 to 0.1`.
* From the output numbers, it shows that **customers are getting more dissatisfied over time**.

---
### Question 6: What is the trend of the number of orders by quarter?

**SQL Query:**

```sql
SELECT
    quarter_number,
    COUNT(order_id) AS TOTAL_ORDER
FROM order_t
GROUP BY quarter_number
ORDER BY quarter_number;
```
**Observation:**
* Number of orders decreased over time from Q1 to Q4.
* In Q1, the number of orders was `310` where as in Q4 it reduced to `199`, resulting in **35.81% decline**.
* There is a **negative trend in the number of orders per quarter**.

---
### Question 7: Calculate the net revenue generated by the company. What is the quarter-over-quarter % change in net revenue?

**SQL Query:**

```sql
SELECT
    quarter_number,
    REVENUE,
    PREVIOUS_REVENUE,
    ROUND(LAG(REVENUE)OVER(ORDER BY quarter_number), 2) AS PREVIOUS_REVENUE,
    ROUND((REVENUE - LAG(REVENUE) OVER(ORDER BY quarter_number))/ LAG(REVENUE) OVER(ORDER BY quarter_number), 2) AS QoQ
FROM (
    SELECT
        quarter_number,
        ROUND(SUM(quantity * (vehicle_price-((discount / 100)*vehicle_price))), 2) AS REVENUE
    FROM order_t
    GROUP BY quarter_number
) AS QUATERLY_REVENUE
ORDER BY quarter_number;
```

**Observation:**
* It shows that there is **decrease in revenue** when compared with previous quarter revenue.
* When we compare per quarter revenue decline, it has decreased `-17%, -11%, -20% per quarter`

---
### Question 8: What is the trend of net revenue and orders by quarters?

**SQL Query:**

```sql
SELECT
    quarter_number,
    ROUND(SUM(quantity * vehicle_price), 2) AS TOTAL_REVENUE,
    COUNT(order_id) AS TOTAL_ORDER
FROM order_t
GROUP BY quarter_number;
```

**Observation:**
* *Declining trend of revenue and total orders by quarter* is observed from the output.
* Revenue decreased from `39.64M` to `23.49M`, showing a **40% reduction**.
* It also shows that total order has **decreased** from `310 to 199`.

---
### Question 9: What is the average discount offered for different types of credit cards?

**SQL Query:**

```sql
SELECT
    credit_card_type,
    ROUND(AVG(discount), 2) AS AVG_DISCOUNT
FROM customer_t
    JOIN order_t
    USING (customer_id)
GROUP BY credit_card_type
ORDER BY AVG_DISCOUNT DESC;
```

**Observation:**
* Highest discount is offered by **laser** `64%` followed by **MasterCard** that is `63%`

---
### Question 9: What is the average time taken to ship the placed orders for each quarter?

**SQL Query:**

```sql
SELECT
    quarter_number,
    ROUND(AVG(JULIANDAY(DATE(ship_date)) - JULIANDAY(DATE(order_date))), 0) AS AVG_TIME
FROM order_t
GROUP BY quarter_number
ORDER BY quarter_number;
```

**Observation:**
* There is a delay in Average shipping time from `Q1 to Q4`.
* In Quater 1, Average shipping time was `57 days` where in Q4 its `174 days`, which is **117 Days more**.
---

## Business Metrics Overview

| **Metric**                 | **Value**        | 
|----------------------------|------------------|
| **Total Revenue**          | `125.4M`         | 
| **Total Orders**           | `1000`           | 
| **Total Customers**        | `994`            |
| **Average Rating**         | `3.14`           |
| **Last Quarter Revenue**   | `23.4M`          |
| **Last Quarter Orders**    | `199`            |
| **Average Days to Ship**   | `98`             |
| **% Good Feedback**        | `22%`            |

---
## Business Recommendations
* There should be more focus on how to **improve customer experience**. 
* A dedicated team should be selected who can **conduct surveys** to gather **customer pain points** and **identify root cause**.
* To retain customers and create loyalty base,** personalized promotions** should be sent out to targeted
customers.
* On low performing areas of sale, a **marketing campaign** can be organized in **social media** to target customers and make them aware of our new promotions.
* To **improve shipping time** for orders, there should be focus on **better logistics**. This can be done by partnering with reliable shipping companies who can deliver order by the given date.